# PRD: FMEA 워크시트 화면 v1.0

## 📋 문서 정보
| 항목 | 내용 |
|------|------|
| **버전** | v1.0.0 |
| **작성일** | 2025-12-26 |
| **상태** | Draft |
| **참조** | PRD-005, FMEA_MASTER_PLAN.md |

---

## 1. 개요

### 1.1 목적
FMEA(Failure Mode and Effects Analysis) 분석을 단계별로 수행할 수 있는 워크시트 화면 개발

### 1.2 핵심 기능
- **좌측 워크시트**: 단계별 데이터 입력 (셀 병합 구조)
- **우측 트리/전체보기**: 계층 구조 시각화 + 40열 미리보기
- **기초정보 모달**: 셀 클릭 시 팝업, 다중선택 지원
- **실시간 동기화**: 입력 데이터가 전체 워크시트에 반영

---

## 2. 화면 구조

### 2.1 전체 레이아웃
```
┌─────────────────────────────────────────────────────────────────────────────┐
│ 📱 상단바 (44px)                                                            │
│ [Level Views▼] [단계▼] | [고장연결] [Excel Export] | [저장상태]            │
├─────────────────────────────────────────────────────────────────────────────┤
│ 탭 메뉴                                                                     │
│ [구조분석] [기능분석] [고장분석] [고장연결] [리스크분석] [최적화] [📊전체]   │
│ [1 Level] [2 Level] [3 Level] [All Level]                                   │
├───────────────────────────────────┬─────────────────────────────────────────┤
│                                   │                                         │
│  📋 좌측: 워크시트 (60%)          │  🌳 우측: 트리/전체보기 (40%)           │
│                                   │                                         │
│  - 단계별 입력 테이블             │  [트리보기] [전체보기] 토글             │
│  - 셀 클릭 → 기초정보 모달        │                                         │
│  - 부모: 셀 병합 (rowspan)        │  트리: 계층 구조 표시                   │
│  - 자식: 개별 행                  │  전체: 40열 미니 워크시트               │
│                                   │                                         │
└───────────────────────────────────┴─────────────────────────────────────────┘
```

### 2.2 레이아웃 비율
| 영역 | 비율 | 설명 |
|------|------|------|
| 상단바 | 44px 고정 | 유틸리티 버튼 |
| 탭 메뉴 | 80px 고정 | 단계 선택 + 레벨 선택 |
| 좌측 워크시트 | 60% | 데이터 입력 영역 |
| 우측 패널 | 40% | 트리 또는 전체보기 |

---

## 3. 단계별 워크시트 정의

### 3.1 구조분석 (Structure Analysis)

#### Level 1 (2열)
| 열 | 컬럼명 | 데이터 소스 | 입력 방식 |
|----|--------|-------------|-----------|
| 1 | 완제품공정명 | 기초정보 | 🔍 모달 선택 |
| 2 | 완제품기능 | 직접입력 | ✏️ 텍스트 |

#### Level 2 (4열)
| 열 | 컬럼명 | 데이터 소스 | 입력 방식 | 병합 |
|----|--------|-------------|-----------|------|
| 1 | 완제품공정명 | 기초정보 | 🔍 모달 | rowspan |
| 2 | 메인공정 (NO+공정명) | 기초정보 | 🔍 모달 | rowspan |
| 3 | 4M | 선택 | ▼ 드롭다운 | - |
| 4 | 작업요소 | 직접입력 | ✏️ 텍스트 | - |

#### Level 3 (6열)
| 열 | 컬럼명 | 데이터 소스 | 입력 방식 | 병합 |
|----|--------|-------------|-----------|------|
| 1 | 완제품공정명 | 기초정보 | 🔍 모달 | rowspan |
| 2 | 메인공정 | 기초정보 | 🔍 모달 | rowspan |
| 3 | 4M | 선택 | ▼ 드롭다운 | rowspan |
| 4 | 작업요소 | 직접입력 | ✏️ 텍스트 | rowspan |
| 5 | 세부4M | 선택 | ▼ 드롭다운 | - |
| 6 | 세부요소 | 직접입력 | ✏️ 텍스트 | - |

### 3.2 기능분석 (Function Analysis)

#### Level 1 (6열)
| 열 | 컬럼명 | 병합 |
|----|--------|------|
| 1 | 완제품공정명 | rowspan |
| 2 | 구분 (Your Plant/Ship to/User) | rowspan |
| 3 | 완제품기능 | rowspan |
| 4 | 요구사항 | - |
| 5 | FE 구분 | - |
| 6 | 고장영향 (FE) | - |

#### Level 2 (10열)
| 열 | 컬럼명 | 병합 |
|----|--------|------|
| 1 | 완제품공정명 | rowspan |
| 2 | 메인공정 | rowspan |
| 3 | 구분 | rowspan |
| 4 | 공정기능 | rowspan |
| 5 | 공정요구사항 | - |
| 6 | FE 구분 | - |
| 7 | 고장영향 (FE) | - |
| 8 | 고장형태 (FM) | - |
| 9 | S (심각도) | - |
| 10 | 고장형태 SC | - |

#### Level 3 (14열)
| 열 | 컬럼명 | 병합 |
|----|--------|------|
| 1-4 | Level 2 동일 | rowspan |
| 5 | 4M | rowspan |
| 6 | 작업요소 | rowspan |
| 7 | 작업요소기능 | - |
| 8 | 작업요소요구 | - |
| 9-14 | FE, FM, FC 관련 | - |

### 3.3 고장분석 (Failure Analysis)

#### Level 3 (12열) - 핵심
| 열 | 컬럼명 | 설명 |
|----|--------|------|
| 1 | 완제품공정명 | rowspan |
| 2 | 메인공정 | rowspan |
| 3 | 4M | rowspan |
| 4 | 작업요소 | rowspan |
| 5 | 고장영향 (FE) | - |
| 6 | S (심각도) | 1-10 |
| 7 | 고장형태 (FM) | - |
| 8 | 고장형태 SC | Y/N |
| 9 | 고장원인 (FC) | - |
| 10 | O (발생도) | 1-10 |
| 11 | 현 예방관리 | - |
| 12 | 현 검출관리 | - |

### 3.4 고장연결 (Failure Linkage)

**특별 레이아웃**: 3개 테이블 + 연결도
```
┌──────────────────────────────────────────┬────────────────────────────────┐
│  📋 3개 테이블 (좌측 55%)                │  🔗 연결도 (우측 45%)          │
│  ┌────────┬────────┬────────┐           │                                │
│  │FE 목록 │FM 목록 │FC 목록 │           │  고장연결도 (FM 중심)          │
│  │(클릭)  │(선택)  │(클릭)  │           │  ┌──┐   ┌──┐   ┌──┐          │
│  │        │        │        │           │  │FE├───│FM├───│FC│          │
│  └────────┴────────┴────────┘           │  └──┘   └──┘   └──┘          │
│                                          │  SVG 연결선                   │
│                                          ├────────────────────────────────┤
│                                          │  연결 결과 테이블              │
│                                          │  FE | FM | FC (병합)          │
└──────────────────────────────────────────┴────────────────────────────────┘
```

### 3.5 리스크분석 (Risk Analysis) - 40열 전체

**전체 40열 워크시트** (Handsontable)
```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        P-FMEA 리스크 분석 (전체 40열)                       │
├─────────────────────────────────────────────────────────────────────────────┤
│ Step1 구조  │ Step2 기능 │ Step3 고장 │ Step4 연결 │ Step5 리스크 │ Step6-7│
│ (4열)       │ (8열)      │ (10열)     │ (4열)      │ (10열)       │ (4열)  │
├─────────────────────────────────────────────────────────────────────────────┤
│ L1│L2│4M│L3│기능│요구│FE│FM│FC│4M│작업│S│O│D│AP│현예방│현검출│조치│담당│일정│
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 4. 기초정보 모달 연동

### 4.1 모달 트리거
| 셀 타입 | 클릭 시 동작 | 모달 타입 |
|---------|-------------|-----------|
| 완제품공정명 | 🔍 모달 팝업 | 고객정보 선택 |
| 메인공정 | 🔍 모달 팝업 | 공정 라이브러리 |
| 4M | ▼ 드롭다운 | MN/MC/IM/EN |
| 구분 | ▼ 드롭다운 | Your Plant/Ship to/User |
| 담당자 | 🔍 모달 팝업 | 사용자정보 선택 |

### 4.2 다중선택 지원
```
┌─────────────────────────────────────────────────────────┐
│ 🔍 공정 라이브러리 선택                        [X 닫기] │
├─────────────────────────────────────────────────────────┤
│ 검색: [________________] [🔍]                           │
├─────────────────────────────────────────────────────────┤
│ [☑] 10 자재입고                                         │
│ [☑] 11 가온                                             │
│ [☐] 20 수입검사                                         │
│ [☐] 30 배합                                             │
│ [☑] 40 압출                                             │
├─────────────────────────────────────────────────────────┤
│ 선택: 3개                    [취소] [✓ 선택 완료]       │
└─────────────────────────────────────────────────────────┘
```

### 4.3 선택 후 동작
1. **단일 선택**: 해당 셀에 값 입력
2. **다중 선택**: 부모 셀 병합 + 자식 행 생성
   ```
   다중 선택: [10 자재입고, 11 가온, 40 압출]
   
   결과:
   ┌──────────┬──────────┬────┬────────┐
   │ 타이어   │ 10 자재입고│ MN │ 작업자  │
   │ 제조공정 ├──────────┼────┼────────┤
   │ (병합)   │ 11 가온   │ MN │ 작업자  │
   │          ├──────────┼────┼────────┤
   │          │ 40 압출   │ MC │ 압출기  │
   └──────────┴──────────┴────┴────────┘
   ```

---

## 5. 트리 구조 (우측 패널)

### 5.1 계층 구조
```
▾ L1: 타이어 제조 공정                    [+ 추가]
   ├─ ▾ L2: 10 자재입고                   [+ 추가]
   │     ├─ [MN] 00 셋업 엔지니어
   │     ├─ [MN] 00 작업자
   │     ├─ [MC] 10 자동창고
   │     └─ [EN] 00 온도
   ├─ ▾ L2: 11 가온
   │     ├─ [MN] 00 작업자
   │     └─ [MC] 11 가온실
   └─ ▾ L2: 20 수입검사
         ├─ [MN] 00 검사원
         └─ [MC] 20 MOONEY VISCOMETER
```

### 5.2 트리 ↔ 워크시트 양방향 동기화
- 트리에서 노드 선택 → 워크시트 해당 행 하이라이트
- 워크시트에서 셀 선택 → 트리 해당 노드 하이라이트
- 트리에서 추가/삭제 → 워크시트 즉시 반영
- 워크시트에서 편집 → 트리 즉시 반영

---

## 6. 전체보기 패널 (우측)

### 6.1 40열 미니 워크시트
```
┌──────────────────────────────────────────────────────────────┐
│ 📊 전체 워크시트 미리보기                    진행률: 35%     │
├──────────────────────────────────────────────────────────────┤
│ ██████████████░░░░░░░░░░░░░░░░░░░░░░░░░░ 35%                │
├──────────────────────────────────────────────────────────────┤
│ │1│2│3│4│5│6│7│8│9│10│11│12│...│38│39│40│                   │
│ ├─┼─┼─┼─┼─┼─┼─┼─┼─┼──┼──┼──┼...┼──┼──┼──┤                   │
│ │✓│✓│✓│✓│✓│✓│ │ │ │  │  │  │...│  │  │  │ ← 입력완료: 파랑 │
│ │✓│✓│✓│✓│✓│✓│ │ │ │  │  │  │...│  │  │  │ ← 미입력: 회색   │
│ │✓│✓│✓│✓│ │ │ │ │ │  │  │  │...│  │  │  │                   │
└──────────────────────────────────────────────────────────────┘
```

### 6.2 단계별 색상 표시
| 열 범위 | 단계 | 색상 |
|---------|------|------|
| 1-4 | 구조분석 | 🟦 파랑 |
| 5-12 | 기능분석 | 🟩 초록 |
| 13-24 | 고장분석 | 🟨 노랑 |
| 25-30 | 고장연결 | 🟧 주황 |
| 31-36 | 리스크분석 | 🟥 빨강 |
| 37-40 | 최적화 | 🟪 보라 |

---

## 7. 데이터 모델

### 7.1 핵심 인터페이스
```typescript
interface FMEAWorksheetData {
  id: string;
  projectId: string;
  
  // L1: 완제품공정
  l1: {
    id: string;
    name: string;        // 완제품공정명
    function: string;    // 완제품기능
  };
  
  // L2: 메인공정 (배열)
  l2: L2Process[];
  
  // 메타데이터
  createdAt: string;
  updatedAt: string;
}

interface L2Process {
  id: string;
  no: string;           // 공정번호 (10, 11, 20...)
  name: string;         // 공정명
  function: string;     // 공정기능
  requirement: string;  // 공정요구사항
  
  // L3: 작업요소 (배열)
  l3: L3WorkElement[];
  
  // 고장분석 데이터
  failures: FailureData[];
}

interface L3WorkElement {
  id: string;
  m4: 'MN' | 'MC' | 'IM' | 'EN';  // 4M 구분
  name: string;                    // 작업요소명
  function: string;                // 작업요소기능
  requirement: string;             // 작업요소요구
  
  // 고장원인 (배열)
  causes: FailureCause[];
}

interface FailureData {
  id: string;
  scope: 'Your Plant' | 'Ship to Plant' | 'User';
  fe: string;          // 고장영향
  fm: string;          // 고장형태
  severity: number;    // 심각도 (1-10)
  fmSC: boolean;       // 특별특성
}

interface FailureCause {
  id: string;
  fc: string;          // 고장원인
  occurrence: number;  // 발생도 (1-10)
  detection: number;   // 검출도 (1-10)
  prevention: string;  // 현 예방관리
  detection: string;   // 현 검출관리
  ap: 'H' | 'M' | 'L'; // Action Priority
}
```

---

## 8. 개발 우선순위

### Phase 1: 기본 레이아웃 (1일)
- [ ] 공통 레이아웃 컴포넌트
- [ ] 탭 메뉴 + 레벨 선택
- [ ] 좌측/우측 패널 분할

### Phase 2: 구조분석 (1일)
- [ ] Level 1/2/3 워크시트
- [ ] 셀 병합 (rowspan) 로직
- [ ] 기초정보 모달 연동

### Phase 3: 기능분석 (1일)
- [ ] Level 1/2/3 워크시트
- [ ] 구분 드롭다운
- [ ] 기능/요구사항 입력

### Phase 4: 고장분석 (1일)
- [ ] FE/FM/FC 입력
- [ ] S/O/D 점수 입력
- [ ] SC 체크박스

### Phase 5: 고장연결 (1일)
- [ ] 3테이블 레이아웃
- [ ] SVG 연결선
- [ ] 연결 결과 테이블

### Phase 6: 리스크분석 (2일)
- [ ] Handsontable 40열
- [ ] AP 자동계산
- [ ] 전체보기 미니맵

### Phase 7: 최적화 & 문서화 (1일)
- [ ] 개선조치 입력
- [ ] Excel Export
- [ ] 보고서 생성

---

## 9. 테스트 URL

| 화면 | URL |
|------|-----|
| FMEA 워크시트 | `/pfmea/worksheet` |
| 구조분석 | `/pfmea/worksheet?tab=structure` |
| 기능분석 | `/pfmea/worksheet?tab=function` |
| 고장분석 | `/pfmea/worksheet?tab=failure` |
| 고장연결 | `/pfmea/worksheet?tab=linkage` |
| 리스크분석 | `/pfmea/worksheet?tab=risk` |

---

## 변경 이력

| 버전 | 날짜 | 변경 내용 |
|------|------|----------|
| v1.0.0 | 2025-12-26 | 초안 작성 |

