# 화면정의서: FMEA 워크시트

## 📋 문서 정보
| 항목 | 내용 |
|------|------|
| **버전** | v1.1.0 |
| **작성일** | 2025-12-28 |
| **관련 PRD** | PRD_FMEA_WORKSHEET_v1.0.md |

---

## 1. 화면 ID 및 경로

| ID | 화면명 | URL |
|----|--------|-----|
| WS-001 | FMEA 워크시트 메인 | `/pfmea/worksheet` |
| WS-002 | 구조분석 | `?tab=structure&level=1,2,3` |
| WS-003 | 기능분석 | `?tab=function&level=1,2,3` |
| WS-004 | 고장분석 | `?tab=failure&level=1,2,3` |
| WS-005 | 고장연결 | `?tab=linkage` |
| WS-006 | 리스크분석 | `?tab=risk` |
| WS-007 | 최적화 | `?tab=optimize` |

---

## 2. 공통 레이아웃

### 2.1 전체 와이어프레임
```
┌─────────────────────────────────────────────────────────────────────────────┐
│ ■ 상단바 (height: 44px, bg: #2b78c5)                                        │
│ ┌─────────────────────────────────────────────────────────────────────────┐ │
│ │ [📁 Level▼] [단계▼] │ [🔗고장연결] [📥Excel] │ 💾저장됨                │ │
│ └─────────────────────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────────────────────┤
│ ■ 탭 메뉴 영역 (height: 80px, bg: #fff, border-bottom: 2px solid #2b78c5)   │
│ ┌─────────────────────────────────────────────────────────────────────────┐ │
│ │ [구조분석] [기능분석] [고장분석] [고장연결] [리스크분석] [최적화] [📊]   │ │
│ │ [1 Level] [2 Level] [3 Level] [All]                                     │ │
│ └─────────────────────────────────────────────────────────────────────────┘ │
├───────────────────────────────────────┬─────────────────────────────────────┤
│ ■ 좌측 워크시트 패널 (60%)            │ ■ 우측 트리/전체보기 패널 (40%)     │
│                                       │                                     │
│ height: calc(100vh - 124px)           │ height: calc(100vh - 124px)         │
│ overflow: auto                        │ overflow: auto                      │
│ bg: #fff                              │ bg: #fff                            │
│                                       │ border-left: 1px solid #d7e1ef      │
│                                       │                                     │
│                                       │ ┌─────────────────────────────────┐ │
│                                       │ │ [🌳트리] [📊전체] 토글 버튼      │ │
│                                       │ └─────────────────────────────────┘ │
│                                       │                                     │
└───────────────────────────────────────┴─────────────────────────────────────┘
```

### 2.2 색상 팔레트
```css
:root {
  --primary: #2b78c5;      /* 메인 파랑 */
  --primary-dark: #1f63aa; /* 진한 파랑 */
  --header-bg: #00587a;    /* 테이블 헤더 */
  --sky: #bfe0ff;          /* 연한 하늘 */
  --sky-light: #d7ecff;    /* 더 연한 하늘 */
  --bg: #f5f7fb;           /* 배경 */
  --line: #6f8fb4;         /* 테두리 */
  --text: #0e223a;         /* 텍스트 */
  
  /* 4M 색상 */
  --mn-bg: #eef7ff;        /* Man */
  --mc-bg: #fff3e6;        /* Machine */
  --im-bg: #f0fff2;        /* Material */
  --en-bg: #fef0ff;        /* Environment */
  
  /* 상태 색상 */
  --success: #2e7d32;
  --warning: #f57c00;
  --danger: #d32f2f;
}
```

---

## 3. 구조분석 화면 (WS-002)

### 3.1 Level 2 와이어프레임
```
┌─────────────────────────────────────────────────────────────────────────────┐
│ 📋 P-FMEA 구조 분석 (2단계)                                                 │
├─────────────────────────────────────────────────────────────────────────────┤
│ 양방향 작성: 좌측 트리에서 추가 ⇄ 우측 워크시트에서 편집                    │
│                                    [+ 작업요소 추가] [선택 노드로 이동]     │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │ 1. 완제품 공정명          │ 2. 메인 공정명    │ 4M  │ 3. 작업 요소명   │ │
│  │ (완제품명+생산라인/공정)  │ (공정NO+공정명)   │     │                  │ │
│  ├───────────────────────────┼───────────────────┼─────┼──────────────────┤ │
│  │                           │                   │     │                  │ │
│  │   🔍 클릭하여 선택        │   🔍 클릭하여선택 │ MN▼ │ ✏️ 직접입력      │ │
│  │                           │                   │ MC  │                  │ │
│  │   [타이어 제조 공정]      │   [10 자재입고]   │ IM  │ [00 셋업엔지니어]│ │
│  │   (rowspan: 전체행)       │   (rowspan: L3수) │ EN  │                  │ │
│  │                           ├───────────────────┼─────┼──────────────────┤ │
│  │                           │   [11 가온]       │ MN  │ [00 작업자]      │ │
│  │                           │   (rowspan: L3수) │     │                  │ │
│  │                           │                   ├─────┼──────────────────┤ │
│  │                           │                   │ MC  │ [11 가온실]      │ │
│  │                           ├───────────────────┼─────┼──────────────────┤ │
│  │                           │   [20 수입검사]   │ MN  │ [00 검사원]      │ │
│  └───────────────────────────┴───────────────────┴─────┴──────────────────┘ │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.2 셀 클릭 동작

#### 완제품공정명 셀 클릭
```
┌─────────────────────────────────────────────────────────────┐
│ 🔍 고객 기초정보 선택                              [X 닫기] │
├─────────────────────────────────────────────────────────────┤
│ 검색: [________________]                                    │
├─────────────────────────────────────────────────────────────┤
│ │NO│ 고객명    │ 코드  │ 공장    │ MY    │ 품명          │ │
│ ├──┼───────────┼───────┼─────────┼───────┼───────────────┤ │
│ │1 │ 현대자동차│ HMC   │ 울산공장│MY2025 │ 타이어 제조   │ │ ← 클릭 시 선택
│ │2 │ 기아자동차│ KIA   │ 광주공장│MY2025 │ 타이어 제조   │ │
│ │3 │ GM Korea │ GMK   │ 부평공장│MY2024 │ 타이어 제조   │ │
├─────────────────────────────────────────────────────────────┤
│ 선택된 항목: 현대자동차 - 타이어 제조                       │
└─────────────────────────────────────────────────────────────┘
```

#### 메인공정 셀 클릭 (다중선택)
```
┌─────────────────────────────────────────────────────────────┐
│ 🔍 공정 라이브러리 선택 (다중 선택 가능)           [X 닫기] │
├─────────────────────────────────────────────────────────────┤
│ 검색: [________________]                                    │
├─────────────────────────────────────────────────────────────┤
│ [☑] 10 자재입고                                             │
│ [☑] 11 가온                                                 │
│ [☐] 20 수입검사                                             │
│ [☐] 30 배합                                                 │
│ [☑] 40 압출                                                 │
│ [☐] 50 반제품 검사                                          │
│ [☐] 60 성형                                                 │
│ [☐] 70 가류                                                 │
├─────────────────────────────────────────────────────────────┤
│ 선택: 3개                         [취소] [✓ 선택 완료]      │
└─────────────────────────────────────────────────────────────┘

선택 결과 → 워크시트에 3개 행 생성 (각 공정별로)
```

#### 4M 드롭다운
```
┌───────┐
│ MN  ▼ │ ← 클릭
├───────┤
│ MN    │ Man (작업자)
│ MC    │ Machine (설비)
│ IM    │ Material (재료)
│ EN    │ Environment (환경)
└───────┘
```

---

## 4. 기능분석 화면 (WS-003)

### 4.1 독립 서브 탭 구성
- 기능분석은 데이터 원자성 확보를 위해 3개의 독립된 워크시트로 분리 운영됨.
- **[L1 완제품]** → **[L2 메인공정]** → **[L3 작업요소]** 순차적 분석 권장.

### 4.2 레벨별 분석 워크시트 정의
1. **L1 완제품 분석 (WS-003-1)**:
   - 대상: 완제품명
   - 정의 항목: 구분(Plant/Ship/User), 완제품 기능, 요구사항
   - 특징: 고장영향(FE)의 원천 데이터가 됨.

2. **L2 메인공정 분석 (WS-003-2)**:
   - 대상: 공정 리스트
   - 정의 항목: 공정 기능, 제품 특성
   - 특징: 고장형태(FM)의 원천 데이터가 됨.

3. **L3 작업요소 분석 (WS-003-3)**:
   - 대상: 4M 기반 작업요소
   - 정의 항목: 작업요소 기능, 공정 특성
   - 특징: 고장원인(FC)의 원천 데이터가 됨.

### 4.3 데이터 원자성 설계 (Atomicity)
- 모든 입력 항목(기능, 요구사항, 특성 등)은 내부적으로 고유 ID를 생성.
- "기능분석 핸드북(전체보기)"은 위 독립 데이터들을 실시간 조립하여 표시.

---

## 5. 고장분석 화면 (WS-004)

### 5.1 Level 3 와이어프레임 (핵심)
```
┌─────────────────────────────────────────────────────────────────────────────┐
│ 📋 P-FMEA 고장 분석 (4단계) - 3 Level                                       │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────┬─────┬────┬──────┬─────────┬───┬─────────┬──┬─────────┬───┬────┐   │
│  │ L1  │ L2  │ 4M │ L3   │ FE      │ S │ FM      │SC│ FC      │ O │ D  │   │
│  ├─────┼─────┼────┼──────┼─────────┼───┼─────────┼──┼─────────┼───┼────┤   │
│  │타이어│10   │ MN │작업자│이물혼입 │ 7 │재료오염 │ Y│부주의   │ 4 │ 5  │   │
│  │제조 │자재 ├────┼──────┼─────────┼───┼─────────┼──┼─────────┼───┼────┤   │
│  │공정 │입고 │ MC │자동창고│이종출고│ 6 │위치이탈 │ N│센서고장 │ 3 │ 4  │   │
│  │     ├─────┼────┼──────┼─────────┼───┼─────────┼──┼─────────┼───┼────┤   │
│  │     │11   │ MN │작업자│온도미달 │ 5 │온도불량 │ Y│제어오류 │ 4 │ 6  │   │
│  │     │가온 ├────┼──────┼─────────┼───┼─────────┼──┼─────────┼───┼────┤   │
│  │     │     │ MC │가온실│가온불량 │ 6 │설비고장 │ N│유지보수 │ 2 │ 3  │   │
│  └─────┴─────┴────┴──────┴─────────┴───┴─────────┴──┴─────────┴───┴────┘   │
│                                                                             │
│  * S: 심각도(1-10), O: 발생도(1-10), D: 검출도(1-10), SC: 특별특성          │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 5.2 S/O/D 점수 선택
```
┌─────────────────────────────────────┐
│ 심각도 (S) 선택                     │
├─────────────────────────────────────┤
│ 10 │ 안전/법규 위반 (경고없이 발생) │
│  9 │ 안전/법규 위반 (경고 후 발생)  │
│  8 │ 차량 주요 기능 상실           │
│  7 │ 차량 성능 저하 (불편)         │
│  6 │ 부분 기능 상실                │
│  5 │ 편의기능 상실                 │
│  4 │ 대부분 고객 인지              │
│  3 │ 일부 고객 인지                │
│  2 │ 민감한 고객만 인지            │
│  1 │ 영향 없음                     │
└─────────────────────────────────────┘
```

---

## 6. 고장연결 화면 (WS-005)

### 6.1 3테이블 + 연결도 레이아웃
```
┌───────────────────────────────────────────┬───────────────────────────────────┐
│ 📋 좌측: 3개 독립 테이블 (55%)            │ 🔗 우측: 연결도 + 결과 (45%)       │
├───────────┬───────────┬───────────────────┼───────────────────────────────────┤
│ 1. FE목록 │ 2. FM목록 │ 3. FC목록         │ ┌───────────────────────────────┐ │
│           │ (먼저선택)│                   │ │ 고장 연결도 (FM 중심)         │ │
├───────────┼───────────┼───────────────────┤ │ [수정] [연결확정]             │ │
│ 구분 │ FE │공정명│FM │공정명│4M│작업│FC│ │ ├───────────────────────────────┤ │
├──────┼────┼──────┼───┼──────┼──┼────┼──┤ │ │                               │ │
│Your  │1.1 │10자재│재료│10자재│MN│작업│부 │ │ │  ┌──┐       ┌──┐       ┌──┐ │ │
│Plant │오염│입고  │오염│입고  │  │자  │주 │ │ │  │FE├──────│FM├──────│FC│ │ │
│      │    │      │(SC)│      │  │    │의 │ │ │  │  │      │  │      │  │ │ │
│Ship  │2.2 │11가온│온도│      │MC│설비│센 │ │ │  └──┘       └──┘       └──┘ │ │
│to    │성능│      │미달│      │  │    │서 │ │ │                               │ │
│Plant │저하│      │    │      │  │    │   │ │ │  SVG 연결선으로 표시          │ │
│      │    │      │    │      │  │    │   │ │ ├───────────────────────────────┤ │
│User  │3.2 │      │    │      │  │    │   │ │ │ 📊 연결 결과 테이블           │ │
│      │마모│      │    │      │  │    │   │ │ │ FE│S│FM(병합)│4M│작업│FC    │ │
│      │    │      │    │      │  │    │   │ │ └───────────────────────────────┘ │
└──────┴────┴──────┴───┴──────┴──┴────┴──┘ └───────────────────────────────────┘

동작:
1. FM 목록에서 고장형태 선택 (먼저)
2. FE 목록에서 연결할 고장영향 클릭 (다중선택)
3. FC 목록에서 연결할 고장원인 클릭 (다중선택)
4. 우측 연결도에 실시간 반영
5. [연결확정] 클릭 → 결과 테이블에 저장
```

---

## 7. 리스크분석 화면 (WS-006)

### 7.1 40열 전체 워크시트 (Handsontable)
```
┌─────────────────────────────────────────────────────────────────────────────┐
│ 📊 P-FMEA 리스크 분석 - 전체 워크시트 (40열)                                │
├─────────────────────────────────────────────────────────────────────────────┤
│ [필터] [정렬] [컬럼숨기기] [Excel Export] [저장]                            │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ← 가로 스크롤 →                                                            │
│  ┌────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬ ... ┬────┬────┐  │
│  │ 1  │ 2  │ 3  │ 4  │ 5  │ 6  │ 7  │ 8  │ 9  │10  │11  │ ... │39  │40  │  │
│  │ L1 │ L2 │ 4M │ L3 │기능│요구│ FE │ S  │ FM │SC  │ FC │ ... │담당│일정│  │
│  ├────┼────┼────┼────┼────┼────┼────┼────┼────┼────┼────┼ ... ┼────┼────┤  │
│  │    │    │    │    │    │    │    │    │    │    │    │     │    │    │  │
│  │    │    │    │    │    │    │    │    │    │    │    │     │    │    │  │
│  │    │    │    │    │    │    │    │    │    │    │    │     │    │    │  │
│  └────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴ ... ┴────┴────┘  │
│                                                                             │
│  행 높이: 32px, 컬럼 너비: 자동조정                                         │
│  셀 병합: L1, L2 기준 rowspan 적용                                          │
│                                                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│ 📊 AP 통계: H: 12건 (30%) | M: 18건 (45%) | L: 10건 (25%)                   │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 7.2 AP (Action Priority) 자동계산
```
AP = f(S, O, D)

┌─────────────────────────────────────┐
│ AP 계산 로직                        │
├─────────────────────────────────────┤
│ H (High)   : S≥9 또는 S*O*D ≥ 100  │ 🔴 빨강
│ M (Medium) : S≥5 또는 S*O*D ≥ 50   │ 🟡 노랑
│ L (Low)    : 그 외                  │ 🟢 초록
└─────────────────────────────────────┘
```

---

## 8. 우측 패널 토글

### 8.1 트리보기 모드
```
┌─────────────────────────────────────┐
│ [🌳트리보기]  [📊전체보기]          │
├─────────────────────────────────────┤
│                                     │
│ ▾ 타이어 제조 공정          [+ 추가]│
│   │                                 │
│   ├─▾ 10 자재입고           [+ 추가]│
│   │   ├─ [MN] 00 셋업 엔지니어      │
│   │   ├─ [MN] 00 작업자             │
│   │   ├─ [MC] 10 자동창고           │
│   │   └─ [EN] 00 온도               │
│   │                                 │
│   ├─▾ 11 가온               [+ 추가]│
│   │   ├─ [MN] 00 작업자             │
│   │   └─ [MC] 11 가온실             │
│   │                                 │
│   └─▸ 20 수입검사 (접힘)            │
│                                     │
│ 🔍 검색: [____________] [초기화]    │
│                                     │
└─────────────────────────────────────┘
```

### 8.2 전체보기 모드 (미니맵)
```
┌─────────────────────────────────────┐
│ [🌳트리보기]  [📊전체보기]          │
├─────────────────────────────────────┤
│ 진행률: ████████████░░░░░░░░ 60%    │
├─────────────────────────────────────┤
│                                     │
│ ┌─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┐  │
│ │█│█│█│█│█│█│█│█│░│░│░│░│░│░│░│░│  │
│ │█│█│█│█│█│█│█│█│░│░│░│░│░│░│░│░│  │
│ │█│█│█│█│█│░│░│░│░│░│░│░│░│░│░│░│  │
│ │█│█│█│█│░│░│░│░│░│░│░│░│░│░│░│░│  │
│ └─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┘  │
│                                     │
│ █ 입력완료  ░ 미입력                │
│                                     │
│ 구조: ████ 100%                     │
│ 기능: ████ 80%                      │
│ 고장: ██░░ 50%                      │
│ 리스크: ░░░░ 0%                     │
│                                     │
└─────────────────────────────────────┘
```

---

## 9. 컴포넌트 목록

| 컴포넌트 | 경로 | 설명 |
|----------|------|------|
| `FMEAWorksheetLayout` | `components/worksheet/Layout.tsx` | 공통 레이아웃 |
| `WorksheetTopBar` | `components/worksheet/TopBar.tsx` | 상단바 |
| `WorksheetTabs` | `components/worksheet/Tabs.tsx` | 탭 메뉴 |
| `StructureAnalysis` | `components/worksheet/StructureAnalysis.tsx` | 구조분석 |
| `FunctionAnalysis` | `components/worksheet/FunctionAnalysis.tsx` | 기능분석 |
| `FailureAnalysis` | `components/worksheet/FailureAnalysis.tsx` | 고장분석 |
| `FailureLinkage` | `components/worksheet/FailureLinkage.tsx` | 고장연결 |
| `RiskAnalysis` | `components/worksheet/RiskAnalysis.tsx` | 리스크분석 |
| `TreePanel` | `components/worksheet/TreePanel.tsx` | 트리 패널 |
| `OverviewPanel` | `components/worksheet/OverviewPanel.tsx` | 전체보기 패널 |
| `ProcessSelectModal` | `components/modals/ProcessSelectModal.tsx` | 공정 선택 모달 |

---

## 10. 변경 이력

| 버전 | 날짜 | 변경 내용 |
|------|------|----------|
| v1.0.0 | 2025-12-26 | 초안 작성 |


