<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>FMEA ìºì‹œ ì´ˆê¸°í™”</title>
  <style>
    body { font-family: sans-serif; padding: 40px; text-align: center; }
    .btn { padding: 15px 30px; font-size: 18px; cursor: pointer; margin: 10px; }
    .success { color: green; font-size: 20px; margin-top: 20px; }
    .list { text-align: left; max-width: 600px; margin: 20px auto; background: #f5f5f5; padding: 20px; border-radius: 8px; }
  </style>
</head>
<body>
  <h1>ğŸ§¹ FMEA ìºì‹œ ì´ˆê¸°í™”</h1>
  <p>ì˜ëª»ëœ ë°ì´í„°ê°€ í‘œì‹œë˜ëŠ” ê²½ìš° ì•„ë˜ ë²„íŠ¼ìœ¼ë¡œ ìºì‹œë¥¼ ì´ˆê¸°í™”í•˜ì„¸ìš”.</p>
  
  <button class="btn" onclick="clearRiskData()">ğŸ”´ riskDataë§Œ ì‚­ì œ</button>
  <button class="btn" onclick="clearAll()">ğŸ”´ ëª¨ë“  FMEA ìºì‹œ ì‚­ì œ</button>
  
  <div id="result"></div>
  <div id="list" class="list" style="display:none;"></div>
  
  <script>
    function listKeys() {
      const keys = [];
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key && (key.includes('fmea') || key.includes('pfmea') || key.includes('worksheet'))) {
          keys.push(key);
        }
      }
      return keys;
    }
    
    function clearRiskData() {
      const keys = listKeys();
      let count = 0;
      
      keys.forEach(key => {
        try {
          const data = JSON.parse(localStorage.getItem(key));
          if (data && data.riskData) {
            // riskDataì—ì„œ S/O/D í‚¤ ì¤‘ ìˆ«ìê°€ ì•„ë‹Œ ê²ƒ ì‚­ì œ
            const toDelete = Object.keys(data.riskData).filter(k => {
              const val = data.riskData[k];
              return (k.includes('-O') || k.includes('-D') || k.includes('-S')) && typeof val !== 'number';
            });
            
            toDelete.forEach(k => {
              delete data.riskData[k];
              count++;
            });
            
            localStorage.setItem(key, JSON.stringify(data));
          }
        } catch (e) {}
      });
      
      document.getElementById('result').innerHTML = 
        '<div class="success">âœ… ' + count + 'ê°œ ì˜ëª»ëœ riskData í‚¤ ì‚­ì œ ì™„ë£Œ!</div>' +
        '<p><a href="/pfmea/worksheet?id=PFM26-M001">ì›Œí¬ì‹œíŠ¸ë¡œ ëŒì•„ê°€ê¸°</a></p>';
    }
    
    function clearAll() {
      const keys = listKeys();
      keys.forEach(key => localStorage.removeItem(key));
      
      document.getElementById('result').innerHTML = 
        '<div class="success">âœ… ' + keys.length + 'ê°œ FMEA ìºì‹œ ì‚­ì œ ì™„ë£Œ!</div>' +
        '<p><a href="/pfmea/worksheet?id=PFM26-M001">ì›Œí¬ì‹œíŠ¸ë¡œ ëŒì•„ê°€ê¸°</a></p>';
    }
    
    // í˜„ì¬ ì €ì¥ëœ í‚¤ ëª©ë¡ í‘œì‹œ
    const keys = listKeys();
    if (keys.length > 0) {
      document.getElementById('list').style.display = 'block';
      document.getElementById('list').innerHTML = '<strong>ì €ì¥ëœ FMEA ìºì‹œ:</strong><ul>' + 
        keys.map(k => '<li>' + k + '</li>').join('') + '</ul>';
    }
  </script>
</body>
</html>

