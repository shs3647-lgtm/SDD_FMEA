<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>FMEA ID ìˆ˜ì •</title>
  <style>
    body { font-family: 'Segoe UI', sans-serif; padding: 40px; background: #1a237e; color: white; }
    .container { max-width: 600px; margin: 0 auto; background: #283593; padding: 30px; border-radius: 12px; }
    h1 { margin-bottom: 20px; }
    button { padding: 12px 24px; font-size: 16px; cursor: pointer; margin: 10px 5px 10px 0; border: none; border-radius: 6px; }
    .primary { background: #4caf50; color: white; }
    .danger { background: #f44336; color: white; }
    .info { background: #2196f3; color: white; }
    pre { background: #1a237e; padding: 15px; border-radius: 6px; overflow-x: auto; font-size: 13px; }
    .result { margin-top: 20px; padding: 15px; border-radius: 6px; }
    .success { background: #4caf50; }
    .error { background: #f44336; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ”§ FMEA ID ìˆ˜ì • ë„êµ¬</h1>
    
    <h3>í˜„ì¬ í”„ë¡œì íŠ¸ ëª©ë¡</h3>
    <pre id="projectList">ë¡œë”© ì¤‘...</pre>
    
    <h3>ì‘ì—… ì„ íƒ</h3>
    <button class="primary" onclick="fixSddId()">SDD FMEA â†’ PFM26-001ë¡œ ë³€ê²½</button>
    <button class="info" onclick="reorderAllIds()">ëª¨ë“  ID ìˆœì°¨ ì¬ì •ë ¬ (001ë¶€í„°)</button>
    <button class="danger" onclick="clearDraft()">ì„ì‹œ ì €ì¥ ë°ì´í„° ì‚­ì œ</button>
    
    <div id="result"></div>
  </div>

  <script>
    function loadProjects() {
      const projects = JSON.parse(localStorage.getItem('pfmea-projects') || '[]');
      const list = projects.map((p, i) => `${i+1}. ${p.id} - ${p.fmeaInfo?.subject || p.project?.productName || '(ì œëª©ì—†ìŒ)'}`).join('\n');
      document.getElementById('projectList').textContent = list || 'ë“±ë¡ëœ í”„ë¡œì íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.';
      return projects;
    }
    
    function showResult(success, message) {
      const result = document.getElementById('result');
      result.className = 'result ' + (success ? 'success' : 'error');
      result.innerHTML = message;
    }
    
    function fixSddId() {
      const projects = JSON.parse(localStorage.getItem('pfmea-projects') || '[]');
      
      // SDD FMEA ë˜ëŠ” PFM26-516 ì°¾ê¸°
      const sddProject = projects.find(p => 
        p.fmeaInfo?.subject === 'SDD' || 
        p.id === 'PFM26-516' ||
        p.id?.includes('516')
      );
      
      if (sddProject) {
        const oldId = sddProject.id;
        sddProject.id = 'PFM26-001';
        
        // ì›Œí¬ì‹œíŠ¸ ë°ì´í„°ë„ ID ë³€ê²½
        const wsData = localStorage.getItem(`pfmea-worksheet-${oldId}`);
        if (wsData) {
          localStorage.setItem('pfmea-worksheet-PFM26-001', wsData);
          localStorage.removeItem(`pfmea-worksheet-${oldId}`);
        }
        
        localStorage.setItem('pfmea-projects', JSON.stringify(projects));
        localStorage.removeItem('pfmea-register-draft');
        
        showResult(true, `âœ… ID ë³€ê²½ ì™„ë£Œ!<br>ì´ì „: ${oldId}<br>í˜„ì¬: PFM26-001<br><br>3ì´ˆ í›„ ë¦¬ìŠ¤íŠ¸ë¡œ ì´ë™í•©ë‹ˆë‹¤...`);
        
        setTimeout(() => {
          window.location.href = '/pfmea/list';
        }, 3000);
      } else {
        showResult(false, 'âŒ SDD FMEAë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
      }
      
      loadProjects();
    }
    
    function reorderAllIds() {
      const projects = JSON.parse(localStorage.getItem('pfmea-projects') || '[]');
      const year = new Date().getFullYear().toString().slice(-2);
      
      // ìƒì„±ì¼ì ìˆœìœ¼ë¡œ ì •ë ¬ í›„ ìˆœì°¨ ID ë¶€ì—¬
      projects.sort((a, b) => new Date(a.createdAt || 0).getTime() - new Date(b.createdAt || 0).getTime());
      
      const changes = [];
      projects.forEach((p, i) => {
        const oldId = p.id;
        const newId = `PFM${year}-${(i + 1).toString().padStart(3, '0')}`;
        
        if (oldId !== newId) {
          // ì›Œí¬ì‹œíŠ¸ ë°ì´í„°ë„ ID ë³€ê²½
          const wsData = localStorage.getItem(`pfmea-worksheet-${oldId}`);
          if (wsData) {
            localStorage.setItem(`pfmea-worksheet-${newId}`, wsData);
            localStorage.removeItem(`pfmea-worksheet-${oldId}`);
          }
          
          changes.push(`${oldId} â†’ ${newId}`);
          p.id = newId;
        }
      });
      
      localStorage.setItem('pfmea-projects', JSON.stringify(projects));
      localStorage.removeItem('pfmea-register-draft');
      
      if (changes.length > 0) {
        showResult(true, `âœ… ${changes.length}ê°œ ID ë³€ê²½ ì™„ë£Œ!<br><br>${changes.join('<br>')}<br><br>3ì´ˆ í›„ ë¦¬ìŠ¤íŠ¸ë¡œ ì´ë™í•©ë‹ˆë‹¤...`);
        setTimeout(() => {
          window.location.href = '/pfmea/list';
        }, 3000);
      } else {
        showResult(true, 'âœ… ë³€ê²½í•  IDê°€ ì—†ìŠµë‹ˆë‹¤. ì´ë¯¸ ìˆœì°¨ì ì…ë‹ˆë‹¤.');
      }
      
      loadProjects();
    }
    
    function clearDraft() {
      localStorage.removeItem('pfmea-register-draft');
      localStorage.removeItem('dfmea-register-draft');
      showResult(true, 'âœ… ì„ì‹œ ì €ì¥ ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
    }
    
    // ì´ˆê¸° ë¡œë“œ
    loadProjects();
  </script>
</body>
</html>



