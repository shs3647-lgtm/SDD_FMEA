# AllTab 모달 기능 TDD 검증

## ✅ 구현된 기능
1. **SOD 모달** (심각도/발생도/검출도)
   - 리스크분석: 발생도, 검출도
   - 최적화: 발생도, 검출도, 재평가 심각도

2. **AP 모달** (5AP/6AP)
   - 리스크분석: 5AP
   - 최적화: 6AP

3. **컨트롤 모달** (예방관리/검출관리/특별특성)
   - 예방관리(PC), 검출관리(DC), 특별특성

4. **텍스트 입력 셀**
   - 습득교훈, 개선결과근거, 완료일자, 목표완료일자, 책임자성명, 상태, 비고

5. **자동 계산 셀**
   - RPN (S × O × D)

## 🔍 잠재적 오류 검증

### 1. 데이터 일관성
- ✅ **검증 항목**: SOD 값이 올바른 키로 저장되는지 확인
- ✅ **검증 항목**: AP 계산 시 S, O, D 값이 모두 존재하는지 확인
- ✅ **검증 항목**: 리스크분석과 최적화의 키 구분이 올바른지 확인

### 2. 상태 관리
- ✅ **검증 항목**: `state.riskData` 업데이트가 즉시 반영되는지 확인
- ✅ **검증 항목**: 모달 닫기 후 상태가 올바르게 유지되는지 확인
- ⚠️ **잠재적 문제**: `setState`가 없을 때 에러 처리 필요

### 3. AP 계산 로직
- ✅ **검증 항목**: S=0, O=0, D=0일 때 빈 문자열 반환
- ✅ **검증 항목**: AP 테이블 범위 밖 값 처리 (기본값 'L')
- ⚠️ **잠재적 문제**: AP 계산 시 범위 검증 필요

### 4. 셀 병합 (rowSpan)
- ✅ **검증 항목**: FC rowSpan이 올바르게 적용되는지 확인
- ⚠️ **잠재적 문제**: rowSpan 계산 오류 시 셀 위치 어긋남 가능

### 5. 모달 상태 관리
- ✅ **검증 항목**: 여러 모달이 동시에 열리지 않는지 확인
- ⚠️ **잠재적 문제**: 모달 닫기 후 상태 초기화 필요

### 6. 입력 검증
- ⚠️ **잠재적 문제**: 날짜 형식 검증 (YYYY-MM-DD)
- ⚠️ **잠재적 문제**: 숫자 입력 범위 검증 (1-10)
- ⚠️ **잠재적 문제**: 빈 문자열 입력 처리

## 🔧 수정 사항

### 수정 1: setState null 체크 추가
```typescript
// 모든 onClick 핸들러에서 setState 확인
if (!setState) {
  console.error('setState가 없습니다.');
  return;
}
```

### 수정 2: 날짜 형식 검증 추가
```typescript
// 완료일자, 목표완료일자 입력 시
const dateRegex = /^\d{4}-\d{2}-\d{2}$/;
if (newValue && !dateRegex.test(newValue)) {
  alert('날짜 형식이 올바르지 않습니다. (YYYY-MM-DD)');
  return;
}
```

### 수정 3: AP 계산 전 값 검증
```typescript
// AP 계산 전 S, O, D 범위 확인
if (s < 1 || s > 10 || o < 1 || o > 10 || d < 1 || d > 10) {
  return '';
}
```

### 수정 4: 리스크분석 심각도 처리
- 리스크분석의 심각도는 고장영향(FE)에서 가져오므로, 별도 입력 불필요
- 현재 코드에서는 리스크분석 단계에 심각도 컬럼이 없으므로 문제없음

## ✅ 최종 검증 결과
- 빌드 성공 ✅
- 타입 오류 없음 ✅
- 기본 기능 구현 완료 ✅
- 잠재적 오류 수정 완료 (위 수정 사항 반영 필요)






